{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\n\nvar _this = this,\n    _jsxFileName = \"/home/adoilson/\\xC1rea de Trabalho/Cursos/Projetos/mydailstatus/pages/app.js\";\n\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component, useEffect } from 'react';\nimport router from 'next/router';\nimport { IoMdLogOut } from 'react-icons/io';\nimport GoogleMapReact from 'google-map-react';\n\nvar AnyReactComponent = function AnyReactComponent(_ref) {\n  var text1 = _ref.text1,\n      text2 = _ref.text2,\n      text3 = _ref.text3;\n  return __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 10,\n      columnNumber: 3\n    }\n  }, [text1, text2, text3]);\n};\n\nvar App = /*#__PURE__*/function (_Component) {\n  _inherits(App, _Component);\n\n  var _super = _createSuper(App);\n\n  function App(props) {\n    var _this2;\n\n    _classCallCheck(this, App);\n\n    _this2 = _super.call(this, props);\n    useEffect(function () {\n      if (!props.isAuth) {\n        router.push('/');\n      } else if (props.forceCreate) {\n        router.push('/create-status');\n      }\n    });\n\n    if (!props.isAuth || props.forceCreate) {\n      return _possibleConstructorReturn(_this2, null);\n    }\n\n    return _this2;\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return __jsx(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 29,\n          columnNumber: 7\n        }\n      }, __jsx(\"div\", {\n        className: \"mt-2 mb-4 flex flex-row-reverse items-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 30,\n          columnNumber: 9\n        }\n      }, __jsx(\"img\", {\n        src: this.props.user.picture,\n        className: \"mx-2 w-10 rounded-full\",\n        alt: \"perfil\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 31,\n          columnNumber: 11\n        }\n      }), __jsx(\"h3\", {\n        className: \"mr-1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 11\n        }\n      }, props.user.name), __jsx(\"a\", {\n        href: \"/api/logout\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 37,\n          columnNumber: 11\n        }\n      }, __jsx(IoMdLogOut, {\n        color: \"red\",\n        size: 22,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 38,\n          columnNumber: 13\n        }\n      }))), __jsx(\"h1\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41,\n          columnNumber: 9\n        }\n      }, \"Status pr\\xF3ximos a voc\\xEA:\"), props.checkins.map(function (checkin) {\n        return __jsx(\"div\", {\n          className: \"w-screen h-screen\",\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 13\n          }\n        }, __jsx(GoogleMapReact, {\n          bootstrapURLKeys: {\n            key: 'AIzaSyBfGMaKy_LW8yj9bk-qOLs9MI-waCHIgWs'\n          },\n          center: checkin.coords,\n          zoom: 10,\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 45,\n            columnNumber: 15\n          }\n        }, __jsx(AnyReactComponent, {\n          text1: checkin.id === props.user.sub && 'SeuStatus ',\n          lat: checkin.coords.lat,\n          lng: checkin.coords[\"long\"],\n          text2: \"\".concat(checkin.status, \" \"),\n          text3: \"\".concat(checkin.distance, \"km\"),\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 52,\n            columnNumber: 17\n          }\n        })));\n      }));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport var __N_SSP = true;\nexport default App;","map":{"version":3,"sources":["/home/adoilson/Área de Trabalho/Cursos/Projetos/mydailstatus/pages/app.js"],"names":["React","Component","useEffect","router","IoMdLogOut","GoogleMapReact","AnyReactComponent","text1","text2","text3","App","props","isAuth","push","forceCreate","user","picture","name","checkins","map","checkin","key","coords","id","sub","lat","status","distance"],"mappings":";;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,SAA3B,QAA4C,OAA5C;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,SAASC,UAAT,QAA2B,gBAA3B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;;AAKA,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB;AAAA,MAAGC,KAAH,QAAGA,KAAH;AAAA,MAAUC,KAAV,QAAUA,KAAV;AAAA,MAAiBC,KAAjB,QAAiBA,KAAjB;AAAA,SACxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAM,CAACF,KAAD,EAAQC,KAAR,EAAeC,KAAf,CAAN,CADwB;AAAA,CAA1B;;IAGMC,G;;;;;AACJ,eAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,+BAAMA,KAAN;AACAT,IAAAA,SAAS,CAAC,YAAM;AACd,UAAI,CAACS,KAAK,CAACC,MAAX,EAAmB;AACjBT,QAAAA,MAAM,CAACU,IAAP,CAAY,GAAZ;AACD,OAFD,MAEO,IAAIF,KAAK,CAACG,WAAV,EAAuB;AAC5BX,QAAAA,MAAM,CAACU,IAAP,CAAY,gBAAZ;AACD;AACF,KANQ,CAAT;;AAOA,QAAI,CAACF,KAAK,CAACC,MAAP,IAAiBD,KAAK,CAACG,WAA3B,EAAwC;AACtC,gDAAO,IAAP;AACD;;AAXgB;AAYlB;;;;6BAEQ;AAAA;;AACP,aACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAK,QAAA,SAAS,EAAC,8CAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AACE,QAAA,GAAG,EAAE,KAAKH,KAAL,CAAWI,IAAX,CAAgBC,OADvB;AAEE,QAAA,SAAS,EAAC,wBAFZ;AAGE,QAAA,GAAG,EAAC,QAHN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAME;AAAI,QAAA,SAAS,EAAC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAsBL,KAAK,CAACI,IAAN,CAAWE,IAAjC,CANF,EAOE;AAAG,QAAA,IAAI,EAAC,aAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,MAAC,UAAD;AAAY,QAAA,KAAK,EAAC,KAAlB;AAAwB,QAAA,IAAI,EAAE,EAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAPF,CADF,EAYE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAZF,EAaGN,KAAK,CAACO,QAAN,CAAeC,GAAf,CAAmB,UAACC,OAAD,EAAa;AAC/B,eACE;AAAK,UAAA,SAAS,EAAC,mBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACE,MAAC,cAAD;AACE,UAAA,gBAAgB,EAAE;AAChBC,YAAAA,GAAG,EAAE;AADW,WADpB;AAIE,UAAA,MAAM,EAAED,OAAO,CAACE,MAJlB;AAKE,UAAA,IAAI,EAAE,EALR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAOE,MAAC,iBAAD;AACE,UAAA,KAAK,EAAEF,OAAO,CAACG,EAAR,KAAeZ,KAAK,CAACI,IAAN,CAAWS,GAA1B,IAAiC,YAD1C;AAEE,UAAA,GAAG,EAAEJ,OAAO,CAACE,MAAR,CAAeG,GAFtB;AAGE,UAAA,GAAG,EAAEL,OAAO,CAACE,MAAR,QAHP;AAIE,UAAA,KAAK,YAAKF,OAAO,CAACM,MAAb,MAJP;AAKE,UAAA,KAAK,YAAKN,OAAO,CAACO,QAAb,OALP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAPF,CADF,CADF;AAmBD,OApBA,CAbH,CADF;AAqCD;;;;EArDe1B,S;;;AAwDlB,eAAeS,GAAf","sourcesContent":["import React, { Component, useEffect } from 'react';\nimport router from 'next/router';\nimport { IoMdLogOut } from 'react-icons/io';\nimport GoogleMapReact from 'google-map-react';\nimport auth0 from '../lib/auth0';\nimport { db } from '../lib/db';\nimport { distance } from '../lib/geo';\n\nconst AnyReactComponent = ({ text1, text2, text3 }) => (\n  <div>{[text1, text2, text3]}</div>\n);\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    useEffect(() => {\n      if (!props.isAuth) {\n        router.push('/');\n      } else if (props.forceCreate) {\n        router.push('/create-status');\n      }\n    });\n    if (!props.isAuth || props.forceCreate) {\n      return null;\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"mt-2 mb-4 flex flex-row-reverse items-center\">\n          <img\n            src={this.props.user.picture}\n            className=\"mx-2 w-10 rounded-full\"\n            alt=\"perfil\"\n          />\n          <h3 className=\"mr-1\">{props.user.name}</h3>\n          <a href=\"/api/logout\">\n            <IoMdLogOut color=\"red\" size={22} />\n          </a>\n        </div>\n        <h1>Status próximos a você:</h1>\n        {props.checkins.map((checkin) => {\n          return (\n            <div className=\"w-screen h-screen\">\n              <GoogleMapReact\n                bootstrapURLKeys={{\n                  key: 'AIzaSyBfGMaKy_LW8yj9bk-qOLs9MI-waCHIgWs',\n                }}\n                center={checkin.coords}\n                zoom={10}\n              >\n                <AnyReactComponent\n                  text1={checkin.id === props.user.sub && 'SeuStatus '}\n                  lat={checkin.coords.lat}\n                  lng={checkin.coords.long}\n                  text2={`${checkin.status} `}\n                  text3={`${checkin.distance}km`}\n                />\n              </GoogleMapReact>\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nexport default App;\n\nexport async function getServerSideProps({ req, res }) {\n  const session = await auth0.getSession(req);\n  if (session) {\n    const today = new Date();\n    const currentDate = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;\n    const todayCheckin = await db\n      .collection('markers')\n      .doc(currentDate)\n      .collection('checks')\n      .doc(session.user.sub)\n      .get();\n\n    const todaysData = todayCheckin.data();\n    let forceCreate = true;\n    if (todaysData) {\n      forceCreate = false;\n      const checkins = await db\n        .collection('markers')\n        .doc(currentDate)\n        .collection('checks')\n        .near({\n          center: todaysData.coordinates,\n          radius: 20000,\n        })\n        .get();\n      const checkinsList = [];\n      checkins.docs.forEach((doc) => {\n        checkinsList.push({\n          id: doc.id,\n          status: doc.data().status,\n          coords: {\n            lat: doc.data().coordinates.latitude,\n            long: doc.data().coordinates.longitude,\n          },\n          distance: distance(\n            todaysData.coordinates.latitude,\n            todaysData.coordinates.longitude,\n            doc.data().coordinates.latitude,\n            doc.data().coordinates.longitude\n          ).toFixed(2),\n        });\n      });\n      return {\n        props: {\n          isAuth: true,\n          user: session.user,\n          forceCreate: false,\n          checkins: checkinsList,\n        },\n      };\n    }\n\n    return {\n      props: {\n        isAuth: true,\n        user: session.user,\n        forceCreate,\n      },\n    };\n  }\n  return {\n    props: {\n      isAuth: false,\n      user: {},\n    },\n  };\n}\n"]},"metadata":{},"sourceType":"module"}